<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/style/stylecontent.css">
    <script src="../assets/js/funcoes.js"></script>
    <title>Perfil</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="validarSessao(), carregar()">
    
    <div class="info">

        <div class="navbar">
            <div class="perfil">
                <img class="icon" src="../assets/img/User.png">
                <span class="titulo">Bem-vindo de volta</span>
                <span id="nomeusuario"></span>
            </div>

            <div class="links">
                <div class="atual">
                    <span class="titulo"><a href="perfil.html">Perfil</a></span>
                </div>
                <div class="topics">
                    <span class="titulo"><a href="info.html">Informações </a></span>
                </div>
                <div class="topics">
                    <span class="titulo"><a href="piloto.html">Pilotos</a></span>
                </div>
                <div class="topics">
                    <span class="titulo"><a href="equipe.html">Equipes</a></span>
                </div>
                <div class="topics">
                    <span class="titulo"><a href="quiz.html">Quiz</a></span>
                </div>
            </div>

            <div class="exit">
                <button class="botao" onclick="limparSessao()">SAIR</button>
            </div>
        </div>


        <div class="meuperfil">
            <div class="medias">
                <div class="box">
                    <div class="titulo">MÉDIA DE PONTOS QUIZ</div>
                    <div id="div_media" class="texto"></div>
                </div>
                <div class="box">
                    <div class="titulo">TENTATIVAS QUIZ</div>
                    <div id="div_tentativa" class="texto"></div>
                    <canvas id="myChart" style="height: 200px;"></canvas>
                </div>

            </div> 

            <div class="fav">
                <div class="box">
                    <div class="titulo">PILOTO FAVORITO</div>
                </div>
                <div class="box">
                    <div class="titulo">EQUIPE FAVORITO</div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>

<script>

    nomeusuario.innerHTML = sessionStorage.NOME_USUARIO;

    var media = '';
    var tentativas = 0;

    function carregar(id) {

        fetch("/quiz/carregar", {
            method: "POST",                
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({  
                idServer: sessionStorage.ID_USUARIO
            })
            
        }).then(function (resposta) {

            if (resposta.ok) {

                resposta.json().then(json => {
                    
                    media = json[0].media;
                    tentativas = json[0].tentativas;

                    if (media == null) {
                        div_media.innerHTML += `Responda o quiz e veja sua média de acertos`;
                    }
                    if (tentativas == 0) {
                        div_tentativa.innerHTML += `<br> Você ainda não respondeu nosso quiz`;
                    }
                    if (media != null && tentativas > 0) {
                        div_media.innerHTML = `Média de Pontos: ${media}` 
                        div_tentativa.innerHTML = `Número de Tentativas: ${tentativas}`;   
                    }
                })

            } else {

                throw("Houve um erro ao exibir média e número de tentativas");

            }
        
        }).catch(function (resposta) {
            console.log(`${resposta}`);
        });

        return false;   

    }

</script>
